<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Broadband / Tech Headlines</title>

  <!-- Pico CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css">
  <!-- DataTables CSS (jQuery version) -->
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">

  <style>
    body   { background:#f5f7fa; }
    header { max-width:1200px; margin:auto; padding:2rem; }
    main   { max-width:1200px; margin:auto; padding:2rem; }
    #news-table { width:100%; margin-top:1rem; }
  </style>
</head>
<body>
  <header>
    <h1 style="color:black;">Scraped Broadband / Tech Headlines</h1>
    <p>Click to fetch the latest articles (all 13 sources, past&nbsp;90â€¯days).</p>
    <button id="fetch-btn" class="contrast">Fetch Latest News</button>
  </header>

  <main>
    <section id="output-table"></section>
  </main>

  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <!-- DataTables JS (jQuery version) -->
  <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>

  <script>
    async function fetchNews() {
      $('#fetch-btn').prop('disabled', true).text('Loadingâ€¦');

      try {
        // <-- NEW: grab preâ€‘scraped JSON from the Flask backend
        const res = await fetch('http://localhost:8000/api/news');
        if (!res.ok) throw new Error('API error ' + res.status);
        const rows = await res.json();   // [{source, article_title, â€¦}, â€¦]

        // Build DataTable
        const tableHtml = `
          <table id="news-table" class="display stripe">
            <thead>
              <tr>
                <th>Source</th><th>Title</th><th>Date</th><th>Link</th>
              </tr>
            </thead>
            <tbody>
              ${rows.map(r => `
                <tr>
                  <td>${r.source}</td>
                  <td>${r.article_title}</td>
                  <td>${r.article_date}</td>
                  <td><a href="${r.article_url}" target="_blank">ðŸ”—</a></td>
                </tr>`).join('')}
            </tbody>
          </table>`;
        $('#output-table').html(tableHtml);
        $('#news-table').DataTable({ order:[[2,'desc']] });

      } catch (err) {
        $('#output-table').html(`<pre style="color:crimson">${err}</pre>`);
      } finally {
        $('#fetch-btn').prop('disabled', false).text('Fetch Latest News');
      }
    }

    $('#fetch-btn').on('click', fetchNews);
  </script>
</body>
</html>
    $('#fetch-btn').on('click', fetchNews);
  </script>
</body>
</html>
